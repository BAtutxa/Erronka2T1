<app-menu></app-menu>

<ion-content>
  <ion-grid class="content-grid">
    <!-- Barra de búsqueda -->
    <ion-row>
      <ion-col size="12">
        <ion-searchbar
          [(ngModel)]="searchQuery"
          (ionInput)="filterClients()"
          placeholder="Buscar por nombre..."
          showClearButton="true"
        ></ion-searchbar>
      </ion-col>
    </ion-row>

    <!-- Lista de clientes -->
    <ion-row>
      <ion-col size="12">
        <ion-list>
          <!-- Clientes filtrados -->
          <ion-item *ngFor="let client of filteredClients" (click)="selectClient(client)">
            <ion-label>
              <h2>{{ client.name }}</h2>
              <p>Última visita: {{ client.lastVisit?.visitDate | date: 'dd/MM/yyyy' }}</p>
            </ion-label>
          </ion-item>

          <!-- Mensaje si no hay resultados -->
          <ion-item *ngIf="filteredClients.length === 0">
            <ion-label>No se encontraron resultados.</ion-label>
          </ion-item>
        </ion-list>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Modal para mostrar información del cliente -->
  <ion-modal [isOpen]="selectedClient !== null">
    <ion-header>
      <ion-toolbar>
        <ion-title>Detalles de {{ selectedClient?.name }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content *ngIf="selectedClient">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Información del cliente</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Nombre:</strong> {{ selectedClient.name }}</p>
          <p>
            <strong>Última visita:</strong> 
            {{ selectedClient.lastVisit?.visitDate | date: 'dd/MM/yyyy' }} - 
            {{ selectedClient.lastVisit?.service }}
          </p>
        </ion-card-content>
      </ion-card>

      <!-- Lista de visitas -->
      <ion-list>
        <ion-list-header>
          <ion-label>Historial de visitas</ion-label>
        </ion-list-header>
        <ion-item *ngFor="let visit of selectedClient.visits">
          <ion-label>
            <p>Fecha: {{ visit.visitDate | date: 'dd/MM/yyyy' }}</p>
            <p>Servicio: {{ visit.service }}</p>
          </ion-label>
        </ion-item>
      </ion-list>

      <!-- Botón para salir -->
      <ion-button expand="block" color="danger" (click)="closeModal()">
        Salir de la ficha
      </ion-button>
    </ion-content>
  </ion-modal>
</ion-content>
